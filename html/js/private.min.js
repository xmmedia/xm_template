var xm={spinner:'<div class="xm_spinner"><div class="bounce_1"></div><div class="bounce_2"></div><div class="bounce_3"></div></div>'};xm.multiple_edit_count=0,xm.button_link_form=function(){var form,form_target,button_form_action=$(this).data("xm_form_action");button_form_action&&(form=$(this.form),form.attr("action",button_form_action),form_target=$(this).data("xm_form_target"),form_target?form.attr("target",form_target):form.attr("target",""))},xm.button_link=function(){var link=$(this).data("xm_link");link&&(window.location=link)},xm.multiple_edit=function(){},xm.export_selected=function(){},xm.add_multiple_form=function(){var count_select=$(this),add_multiple_button=$("#"+count_select.data("xm_add_multiple_related_button")),add_multiple_form_action_prefix=add_multiple_button.data("xm_add_multiple_form_action_prefix");add_multiple_button.data("xm_form_action",add_multiple_form_action_prefix+"/"+count_select.val())},xm.multiple_edit_form=function(){$(".js_xm_multiple_edit_form_checkbox:checked").length>0?$(".js_xm_multiple_edit, .js_xm_export_selected").removeAttr("disabled"):$(".js_xm_multiple_edit, .js_xm_export_selected").attr("disabled","disabled")},xm.check_all_checkbox=function(){var checkbox=$(this);checkbox.filter(":checked").length>0?$("."+checkbox.data("xm_check_all_checkbox_class")).attr("checked","checked").change():$("."+checkbox.data("xm_check_all_checkbox_class")).removeAttr("checked").change()},xm.row_checked=function(){$(this).attr("checked")?$(this).parents("tr").addClass("selected"):$(this).parents("tr").removeClass("selected")},xm.hide_message=function(e){e.preventDefault(),$(this).closest(".js_xm_message_item").slideUp(function(e){$(e).remove()})},xm.model_select_change=function(){window.location="/dbadmin/"+$("#xm_model_select").val()+"/index"},"undefined"!=typeof $.datepicker&&$.datepicker.setDefaults({dateFormat:"yy-mm-dd",buttonImage:"/xm/images/calendar.gif",buttonImageOnly:!0}),$(function(){"undefined"!=typeof $.datepicker&&$(".js_xm_date_field-date").datepicker(),$(".js_xm_button_link_form").on("click",xm.button_link_form),$(".js_xm_button_link").on("click",xm.button_link),$(".js_xm_multiple_edit").on("click",xm.multiple_edit),$(".js_xm_export_selected").on("click",xm.export_selected),$(".js_xm_multiple_edit_form").on("change",xm.multiple_edit_form),$(".js_xm_check_all_checkbox").on("click",xm.check_all_checkbox),$(".xm_add_multiple_count").on("change",xm.add_multiple_form),$(".js_xm_row_checkbox").on("change",xm.row_checked),$(".js_xm_message").on("click",".js_hide",xm.hide_message),$(".js_xm_model_select_form").on("change",xm.model_select_change),$(".js_xm_model_select_go").on("click",xm.model_select_change)}),xm.ajax_error_msgs={default_msg:"There was a error loading some of the content on this page.<br>Try reloading the page or contacting an administrator.",not_logged_in:'You are no longer logged in. <a href="/login">Click here to login.</a>',timed_out:'Your login has timed out. To continue using your current login, <a href="/login/timedout">click here to enter your password.</a>',not_allowed:"You do not have the necessary permissions to access some of the functionality on this page.",not_found_404:"The requested URL was not found."},xm.add_ajax_error=function(error){xm.add_message_div(error)},xm.add_ajax_validation_msg=function(return_data){xm.hide_ajax_validation_msgs(),null!==return_data&&"object"==typeof return_data&&"undefined"!=typeof return_data.validation_msg&&""!==return_data.validation_msg&&xm.add_message_div(return_data.validation_msg,"xm_ajax_validation_msg")},xm.add_message_div=function(msg,div_class){div_class=2==arguments.length?' class="'+div_class+'"':"";var $msg_div=$("<div"+div_class+'><span class="dismiss js_dismiss"><a href="">X</a></span>'+msg+"</div>");$("#xm_ajax_errors").append($msg_div),$msg_div.slideDown(xm.animate_ajax_body_margin).find(".js_dismiss").on("click",function(e){e.preventDefault(),$(this).parent().parent().slideUp(function(){$(this).remove(),xm.animate_ajax_body_margin()})})},xm.hide_ajax_validation_msgs=function(){$("#xm_ajax_errors div.xm_ajax_validation_msg").slideUp(function(){$(this).remove()})},xm.animate_ajax_body_margin=function(){$("body").animate({marginTop:$("#xm_ajax_errors").height()+"px"},"fast","linear")},xm.add_default_ajax_error=function(return_data,default_msg){0===arguments.length?(return_data=null,default_msg=xm.ajax_error_msgs.default_msg):1==arguments.length&&(default_msg=xm.ajax_error_msgs.default_msg),xm.add_ajax_error(null!==return_data&&"object"==typeof return_data&&"undefined"!=typeof return_data.error_msg&&""!==return_data.error_msg?return_data.error_msg:default_msg)},$("#xm_ajax_errors").ajaxError(function(event,jqXHR,ajaxSettings,thrownError){("undefined"==typeof ajaxSettings.xm_ajax_error_display||ajaxSettings.xm_ajax_error_display)&&(xm.add_ajax_error(xm.ajax_error_msgs.default_msg),in_debug&&xm.ajax_log_msg("AJAX Error: "+thrownError))}),xm.process_ajax=function(return_data){if("object"!=typeof return_data||jQuery.isEmptyObject(return_data))return xm.add_default_ajax_error(),in_debug&&xm.ajax_log_msg("JSON data is not parsable"),!1;if(in_debug&&"undefined"!=typeof return_data.debug_msg&&""!==return_data.debug_msg&&xm.add_ajax_error(return_data.debug_msg),"undefined"==typeof return_data.status)return void(in_debug&&xm.ajax_log_msg("No status property in JSON data"));switch(return_data.status){case 1:return in_debug&&xm.ajax_log_msg("AJAX all good"),!0;case 2:return xm.add_default_ajax_error(return_data,xm.ajax_error_msgs.not_logged_in),in_debug&&xm.ajax_log_msg("The user is not logged in"),!1;case 3:return xm.add_default_ajax_error(return_data,xm.ajax_error_msgs.timed_out),in_debug&&xm.ajax_log_msg("The user has timed out"),!1;case 4:return xm.add_default_ajax_error(return_data,xm.ajax_error_msgs.not_allowed),in_debug&&xm.ajax_log_msg("The user does not have permissions"),!1;case 5:return xm.add_default_ajax_error(return_data,xm.ajax_error_msgs.not_found_404),in_debug&&xm.ajax_log_msg("The page/path could not be found"),!1;case 6:return xm.add_ajax_validation_msg(return_data),in_debug&&xm.ajax_log_msg("There was a validation error"),!1;case 0:default:return xm.add_default_ajax_error(return_data),in_debug&&xm.ajax_log_msg("undefined"!=typeof return_data.debug_msg&&""!==return_data.debug_msg?"AJAX Error: "+return_data.debug_msg:"An unknown error occurred"),!1}},xm.ajax_log_msg=function(msg){try{console.log(msg)}catch(e){}},$(function(){$(".top_nav_wrapper").on("click","li.has_subnav > a",function(e){e.preventDefault(),e.stopPropagation();var link_offset,link_width,link=$(this),sub_nav=link.parent().find(".sub_nav");"hidden"!==sub_nav.css("visibility")?(sub_nav.css({visibility:"hidden"}),link.removeClass("clicked")):($(".top_nav_wrapper li.has_subnav > a.clicked").click(),link_offset=link.offset(),link_width=link.width(),sub_nav.css(sub_nav.hasClass("right")?{right:$(window).width()-(link_offset.left+link_width+39),top:link.parent().innerHeight(),visibility:"visible"}:{left:link_offset.left-5,top:link.parent().innerHeight(),visibility:"visible"}),sub_nav.width()<link_width+19&&sub_nav.css("width",link_width+19+"px"),link.addClass("clicked"),$("html").one("click",function(e){0!==sub_nav.has(e.target).length||sub_nav.is(e.target)||$(".top_nav_wrapper li.has_subnav > a.clicked").click()}))})});